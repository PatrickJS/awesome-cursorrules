/ Dynamic .cursorrules Analyzer - VSCode Extension
// Author: Garot Conklin (garotm)

// What you can build with this ruleset:
A TypeScript-based VSCode extension that:
- Automatically analyzes project codebases for patterns and conventions
- Generates and updates .cursorrules files based on detected patterns
- Monitors file changes in real-time to suggest rule updates
- Manages rule versioning and history
- Integrates directly with VSCode
- Implements intelligent rule merging and conflict resolution
- Offers commands for manual rule generation and validation

// Project Structure
Follow this directory structure:
src/
  extension.ts         # Extension activation and setup
  languageDetector.ts  # Language detection logic
  test/               # Test files
    runTest/          # Test runner setup
    suite/            # Test suites
  types/             # Type definitions

// Development Guidelines
1. Code Quality:
   - Use TypeScript 5.x features
   - Enable strict type checking
   - Follow ESLint configuration
   - Maximum line length: 100 characters
   - Use Prettier for formatting
   - Maintain clean code principles

2. Testing Requirements:
   - Maintain 90%+ test coverage
   - Use Mocha test framework
   - Mock VSCode API when needed
   - Test both success and failure cases
   - Include extension activation tests
   - Document test scenarios

3. Documentation Standards:
   - Use TSDoc comments
   - Document all public APIs
   - Include usage examples
   - Maintain up-to-date README
   - Document extension settings

4. Error Handling:
   - Use typed errors
   - Implement proper logging
   - Handle VSCode lifecycle
   - Handle edge cases
   - Provide clear error messages

5. Performance:
   - Use efficient data structures
   - Implement debouncing for file watchers
   - Optimize extension activation
   - Monitor memory usage
   - Cache when appropriate

// Code Examples:

1. Class Definition Pattern:
```typescript
import * as vscode from 'vscode';
import { Uri } from 'vscode';

export type Language = 'python' | 'typescript' | 'javascript' | 'unknown';

export class LanguageDetector {
    private readonly extensionMap: Record<string, Language> = {
        '.py': 'python',
        '.ts': 'typescript',
        '.js': 'javascript'
    };

    public detectLanguage(uri: Uri): Language {
        const extension = path.extname(uri.fsPath).toLowerCase();
        return this.extensionMap[extension] || 'unknown';
    }
}
```

2. Error Handling Pattern:
```typescript
class RuleAnalysisError extends Error {
    constructor(message: string) {
        super(message);
        this.name = 'RuleAnalysisError';
    }
}

async function analyzeFile(uri: vscode.Uri): Promise<string[]> {
    try {
        // Analysis logic
        return patterns;
    } catch (error) {
        throw new RuleAnalysisError(
            `Failed to analyze ${uri.fsPath}: ${error.message}`
        );
    }
}
```

3. Testing Pattern:
```typescript
import * as assert from 'assert';
import * as vscode from 'vscode';
import { LanguageDetector } from '../../languageDetector';

suite('LanguageDetector Test Suite', () => {
    let detector: LanguageDetector;

    setup(() => {
        detector = new LanguageDetector();
    });

    test('should detect TypeScript files', () => {
        const uri = vscode.Uri.file('/path/to/test.ts');
        assert.strictEqual(detector.detectLanguage(uri), 'typescript');
    });
});
```

// Best Practices:
1. Use VSCode API types consistently
2. Implement proper disposables
3. Use async/await for asynchronous operations
4. Register commands with clear names
5. Follow VSCode extension guidelines
6. Use workspace configuration
7. Implement proper status bar updates
8. Handle extension activation events
9. Write clear commit messages
10. Keep functions focused and small

// Security Considerations:
1. Validate all URIs
2. Don't execute analyzed code
3. Handle workspace trust
4. Sanitize all inputs
5. Use secure defaults
6. Implement proper error handling
7. Log security-relevant events
8. Use safe file operations
9. Validate configuration
10. Handle sensitive data appropriately